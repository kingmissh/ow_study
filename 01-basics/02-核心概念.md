# OpenClaw 核心概念

## 架构概览

OpenClaw 是一个多层架构的 AI 助手平台，主要由以下几个核心部分组成：

```
┌─────────────────────────────────────────────┐
│         消息平台层 (Messaging Layer)         │
│  Telegram | WhatsApp | Discord | Slack...   │
└─────────────────┬───────────────────────────┘
                  │
┌─────────────────▼───────────────────────────┐
│         路由层 (Routing Layer)               │
│  消息路由 | 会话管理 | 认证授权              │
└─────────────────┬───────────────────────────┘
                  │
┌─────────────────▼───────────────────────────┐
│      Agent 运行时 (pi-agent-core)            │
│  LLM 集成 | 工具调用 | 上下文管理            │
└─────────────────┬───────────────────────────┘
                  │
┌─────────────────▼───────────────────────────┐
│         扩展层 (Extension Layer)             │
│  Skills | Plugins | Lobster Workflows       │
└─────────────────┬───────────────────────────┘
                  │
┌─────────────────▼───────────────────────────┐
│         系统层 (System Layer)                │
│  文件系统 | 命令执行 | 浏览器 | API          │
└─────────────────────────────────────────────┘
```

---

## 核心组件

### 1. Gateway（网关）

网关是 OpenClaw 的入口点，负责：
- 接收来自各个消息平台的请求
- 提供 HTTP API 接口
- 处理认证和授权
- 管理连接和会话

**配置示例**：
```json
{
  "gateway": {
    "port": 18900,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "your-secret-token"
    }
  }
}
```

### 2. Channels（通道）

通道负责与各个消息平台的集成：
- Telegram Bot API
- WhatsApp Business API
- Discord Bot
- Slack App
- 其他消息平台

**配置示例**：
```json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "your-bot-token",
      "groups": {
        "-123456789": {
          "requireMention": false,
          "enabled": true
        }
      }
    }
  }
}
```

### 3. Agents（代理）

Agent 是执行任务的核心单元：
- 处理用户消息
- 调用 LLM 模型
- 执行工具和技能
- 管理对话上下文

**配置示例**：
```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "google-antigravity/gemini-3-flash",
        "fallbacks": ["google-antigravity/claude-sonnet-4-5"]
      },
      "maxConcurrent": 4
    }
  }
}
```

### 4. Skills（技能）

Skills 是可扩展的功能模块：
- Python 或 JavaScript 编写
- 提供特定领域的能力
- 可以从 ClawHub 安装
- 支持自定义开发

**常见技能**：
- `notion`: Notion 集成
- `moltbook`: 记账功能
- `email`: 邮件管理
- `calendar`: 日历管理

### 5. Plugins（插件）

Plugins 提供系统级的扩展：
- 认证提供者（OAuth）
- 消息平台集成
- 自定义功能模块

**配置示例**：
```json
{
  "plugins": {
    "entries": {
      "google-antigravity-auth": {
        "enabled": true
      },
      "telegram": {
        "enabled": true
      }
    }
  }
}
```

---

## 关键概念

### 1. 会话管理（Session Management）

OpenClaw 维护长期的对话会话：
- 每个用户/群组有独立的会话
- 会话包含完整的对话历史
- 支持上下文记忆和检索
- 可以跨平台保持连续性

### 2. 工作空间（Workspace）

工作空间是 Agent 的工作目录：
- 存储会话数据
- 保存文件和资源
- 管理技能和配置
- 隔离不同用户的数据

**默认路径**：`~/.openclaw/workspace`

### 3. 模型提供者（Model Providers）

支持多种 LLM 提供者：
- Google (Gemini)
- Anthropic (Claude)
- OpenAI (GPT)
- 本地模型（通过代理）
- 自定义 API

**配置模式**：
- `merge`: 合并多个提供者
- `replace`: 替换默认提供者

### 4. 工具调用（Tool Calling）

Agent 可以调用各种工具：
- 文件操作
- 命令执行
- API 请求
- 浏览器控制
- 自定义技能

### 5. Hooks（钩子）

Hooks 提供事件驱动的自动化：
- `boot-md`: 启动时加载指令
- `command-logger`: 命令日志记录
- `session-memory`: 会话记忆管理

---

## 数据流

### 典型的消息处理流程

```
1. 用户在 Telegram 发送消息
   ↓
2. Telegram Bot API 接收消息
   ↓
3. Gateway 接收并路由消息
   ↓
4. 创建或恢复会话
   ↓
5. Agent 处理消息
   ↓
6. 调用 LLM 模型生成响应
   ↓
7. 执行必要的工具/技能
   ↓
8. 返回响应给用户
   ↓
9. 保存会话状态
```

---

## 配置文件结构

### 主配置文件：`openclaw.json`

```json
{
  "meta": {},           // 元数据
  "wizard": {},         // 向导配置
  "auth": {},           // 认证配置
  "models": {},         // 模型配置
  "agents": {},         // Agent 配置
  "channels": {},       // 通道配置
  "gateway": {},        // 网关配置
  "skills": {},         // 技能配置
  "plugins": {},        // 插件配置
  "hooks": {}           // 钩子配置
}
```

---

## 学习检查点

完成本节后，你应该能够：
- [ ] 理解 OpenClaw 的整体架构
- [ ] 识别各个核心组件的作用
- [ ] 了解消息处理的基本流程
- [ ] 理解配置文件的结构

---

## 下一步

继续学习：[03-环境搭建.md](./03-环境搭建.md)
