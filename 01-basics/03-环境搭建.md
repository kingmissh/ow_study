# OpenClaw 环境搭建

## 系统要求

### 支持的操作系统
- Linux (推荐 Ubuntu 20.04+)
- macOS (10.15+)
- Windows (10/11)
- iOS (通过 Shortcuts)
- Android (通过 Termux)

### 软件依赖
- Node.js 18+ (推荐 20+)
- npm 或 yarn
- Git
- Python 3.8+ (用于某些技能)

---

## 安装方式

### 方式 1：官方安装脚本（推荐）

**Linux/macOS**:
```bash
curl -fsSL https://openclaw.ai/install.sh | bash
```

**Windows (PowerShell)**:
```powershell
irm https://openclaw.ai/install.ps1 | iex
```

### 方式 2：从源码安装

```bash
# 克隆仓库
git clone https://github.com/openclaw/openclaw.git
cd openclaw

# 安装依赖
npm install

# 构建项目
npm run build

# 运行向导
npm run wizard
```

### 方式 3：Docker 部署

```bash
# 拉取镜像
docker pull openclaw/openclaw:latest

# 运行容器
docker run -d \
  --name openclaw \
  -v ~/.openclaw:/root/.openclaw \
  -p 18900:18900 \
  openclaw/openclaw:latest
```

---

## 初始化配置

### 运行配置向导

```bash
openclaw wizard
```

向导会引导你完成：
1. 选择运行模式（本地/服务器）
2. 配置 AI 模型提供者
3. 设置消息平台集成
4. 配置工作空间路径

### 手动配置

配置文件位置：`~/.openclaw/openclaw.json`

**最小配置示例**：
```json
{
  "gateway": {
    "port": 18900,
    "mode": "local"
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "openai/gpt-4"
      }
    }
  }
}
```

---

## 配置 AI 模型

### 使用 OpenAI

```json
{
  "models": {
    "providers": {
      "openai": {
        "apiKey": "sk-your-api-key",
        "models": [
          {
            "id": "gpt-4",
            "name": "GPT-4"
          }
        ]
      }
    }
  }
}
```

### 使用本地模型（通过 Ollama）

```bash
# 安装 Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# 拉取模型
ollama pull llama2
```

```json
{
  "models": {
    "providers": {
      "ollama": {
        "baseUrl": "http://localhost:11434",
        "models": [
          {
            "id": "llama2",
            "name": "Llama 2"
          }
        ]
      }
    }
  }
}
```

### 使用自定义 API（如你的 CLIProxyAPI）

```json
{
  "models": {
    "providers": {
      "cliproxyapi": {
        "baseUrl": "http://127.0.0.1:8317/v1",
        "apiKey": "openclaw-api-key-12345",
        "api": "openai-completions",
        "models": [
          {
            "id": "qwen-coder",
            "name": "Qwen Coder",
            "contextWindow": 128000,
            "maxTokens": 8192
          }
        ]
      }
    }
  }
}
```

---

## 配置消息平台

### Telegram

1. 创建 Bot：
   - 在 Telegram 中找到 @BotFather
   - 发送 `/newbot` 创建新 bot
   - 获取 bot token

2. 配置 OpenClaw：
```json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11",
      "dmPolicy": "pairing"
    }
  }
}
```

3. 启动并配对：
   - 启动 OpenClaw
   - 在 Telegram 中向你的 bot 发送 `/start`

### Discord

1. 创建 Discord 应用：
   - 访问 https://discord.com/developers/applications
   - 创建新应用并添加 Bot
   - 获取 bot token

2. 配置 OpenClaw：
```json
{
  "channels": {
    "discord": {
      "enabled": true,
      "botToken": "your-discord-bot-token"
    }
  }
}
```

---

## 启动 OpenClaw

### 前台运行（开发模式）

```bash
openclaw start
```

### 后台运行（生产模式）

**使用 systemd (Linux)**:
```bash
# 创建服务文件
sudo nano /etc/systemd/system/openclaw.service
```

```ini
[Unit]
Description=OpenClaw AI Assistant
After=network.target

[Service]
Type=simple
User=your-username
ExecStart=/usr/local/bin/openclaw start
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
# 启动服务
sudo systemctl enable openclaw
sudo systemctl start openclaw
```

**使用 PM2 (跨平台)**:
```bash
npm install -g pm2
pm2 start openclaw --name openclaw
pm2 save
pm2 startup
```

---

## 验证安装

### 检查服务状态

```bash
# 检查进程
ps aux | grep openclaw

# 检查端口
netstat -an | grep 18900

# 查看日志
tail -f ~/.openclaw/logs/openclaw.log
```

### 测试 API

```bash
curl http://localhost:18900/health
```

预期响应：
```json
{
  "status": "ok",
  "version": "2026.2.14"
}
```

### 测试消息平台

在配置的消息平台（如 Telegram）中：
1. 向 bot 发送 "Hello"
2. 应该收到 AI 的回复
3. 尝试发送 "帮我创建一个文件"

---

## 常见问题

### 1. 端口被占用

```bash
# 修改配置文件中的端口
"gateway": {
  "port": 18901
}
```

### 2. 模型 API 连接失败

- 检查 API key 是否正确
- 检查网络连接
- 检查 baseUrl 是否可访问

### 3. Telegram bot 无响应

- 确认 bot token 正确
- 检查 OpenClaw 是否正在运行
- 查看日志文件排查错误

### 4. 权限问题

```bash
# 确保工作空间目录有写权限
chmod -R 755 ~/.openclaw
```

---

## 开发环境设置

### VS Code 配置

安装推荐扩展：
- ESLint
- Prettier
- TypeScript and JavaScript Language Features

### 调试配置

`.vscode/launch.json`:
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Debug OpenClaw",
      "program": "${workspaceFolder}/dist/index.js",
      "preLaunchTask": "npm: build",
      "outFiles": ["${workspaceFolder}/dist/**/*.js"]
    }
  ]
}
```

---

## 学习检查点

完成本节后，你应该能够：
- [ ] 成功安装 OpenClaw
- [ ] 配置至少一个 AI 模型提供者
- [ ] 配置至少一个消息平台
- [ ] 启动 OpenClaw 并验证运行状态
- [ ] 通过消息平台与 AI 进行基本交互

---

## 下一步

继续学习：[04-第一个示例.md](./04-第一个示例.md)
